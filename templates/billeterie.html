<!doctype html>
<html lang="fr">
<head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Billetterie</title>

  
  <link rel="stylesheet" href="/public/css/index.css">
  <link rel="stylesheet" href="/public/css/billeterie.css">
  <link rel="stylesheet" href="/public/css/session-toast.css">
  <!-- Font Awesome pour les icônes sociales -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="icon" href="/public/images/favicon.ico" type="image/x-icon">

</head>

<body>
 
  <header>
    <nav class="navbar">
      <div class="navbar-left">
        <div class="olympic-rings">
          <span class="ring blue"></span>
          <span class="ring yellow"></span>
          <span class="ring black"></span>
          <span class="ring green"></span>
          <span class="ring red"></span>
          <span class="navbar-title">Olympic Games</span>
        </div>
      </div>
      <ul class="navbar-links" id="primary-navigation">
        <li><a href="/">Accueil</a></li>
        <li><a href="/billeterie.html" aria-current="page">Billeterie</a></li>
      </ul>
      <div class="navbar-actions">
        <a class="btn-login" href="/auth">Connexion</a>
        <!-- Icône Panier + pastille -->
        <a href="/session" class="btn-cart" title="Panier">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" style="vertical-align:middle">
            <circle cx="10" cy="20" r="1.6"></circle>
            <circle cx="18" cy="20" r="1.6"></circle>
            <path d="M2 3h3l3.6 11.6a2 2 0 0 0 2 1.4H18a2 2 0 0 0 2-1.6L22 7H6"></path>
          </svg>
          <span id="cart-count-pill" class="badge" aria-label="Articles dans le panier" style="margin-left:6px; display:none">0</span>
        </a>
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Message d’aide / feedback -->
  <div id="client-msg" class="msg info" style="max-width:980px;margin:12px auto; display:block">
    Sélectionnez un événement, puis une offre pour l’ajouter au panier.
  </div>

  <main>
  <!-- Section événements (inchangée) -->
  <section class="events-section">
    <h2 class="section-title">Événements</h2>
    <div class="events-grid">
      {% for ev in evenements %}
      <div class="event-card selectable"
           data-ev-id="{{ ev.id }}"
           data-ev-nom="{{ ev.nom_evenement }}"
           data-ev-type="{{ ev.type_evenement }}"
           data-ev-date="{{ ev.date_evenement[:10] }}">
        <img src="/public/images/olympic-medal.png" alt="{{ ev.nom_evenement }}" class="event-img">
        <div class="event-content">
          <h3>{{ ev.nom_evenement }}</h3>
          <p>{{ ev.type_evenement }} • {{ ev.lieu }} • {{ ev.date_evenement[:10] }}</p>
          <button class="event-select-btn" type="button" title="Sélectionner {{ ev.nom_evenement }}"><span class="arrow">→</span></button>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Section offres -->
  <section class="events-section">
    <h2 class="section-title">Nos Offres</h2>
    <div class="events-grid">
      {% if offres and offres|length > 0 %}
        {% for offre in offres %}
        <div class="event-card">
          <div class="event-img solo"></div>
          <div class="event-content">
            <h3>{{ offre.title }}</h3>
            <p>Ticket pour {{ offre.title }}.</p>
            <p style="margin-top:8px;color:#444">Prix: {{ '%.2f'|format(offre.price|default(0)) }} €</p>
            <button
              class="btn-login btn-add-to-cart"
              data-id="{{ offre.id }}"
              data-title="{{ offre.title }}"
              data-price="{{ offre.price|default(0) }}"
              type="button">
              Ajouter au panier
            </button>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <p>Aucune offre disponible pour le moment.</p>
      {% endif %}
    </div>
  </section>
</main>


    <!--FOOTER-->
    <footer class="main-footer">
        <div class="footer-grid">
          <div class="footer-column">
            <h3>À propos</h3>
            <ul class="footer-links">
              <li><a href="#">Qui sommes-nous</a></li>
              <li><a href="#">Partenaires officiels</a></li>
              <li><a href="#">Carrières</a></li>
              <li><a href="#">Presse</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Support</h3>
            <ul class="footer-links">
              <li><a href="#">Centre d'aide</a></li>
              <li><a href="#">Contacter le support</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="#">Conditions de vente</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Informations légales</h3>
            <ul class="footer-links">
              <li><a href="#">Conditions d'utilisation</a></li>
              <li><a href="#">Politique de confidentialité</a></li>
              <li><a href="#">Mentions légales</a></li>
              <li><a href="#">Cookies</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Suivez-nous</h3>
            <div class="footer-social">
              <a href="#" class="social-icon"><i class="fa-brands fa-facebook"></i></a>
              <a href="#" class="social-icon"><i class="fa-brands fa-twitter"></i></a>
              <a href="#" class="social-icon"><i class="fa-brands fa-instagram"></i></a>
              <a href="#" class="social-icon"><i class="fa-brands fa-youtube"></i></a>
            </div>
            <p>Téléchargez notre application</p>
            <div class="footer-apps">
              <a href="#"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg" alt="App Store"></a>
              <a href="#"><img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Google Play"></a>
            </div>
          </div>
          </div>
          <div class="footer-bottom">
            <p>© 2025 OlympicTickets. Tous droits réservés.</p>
            <div class="payment-icons">
              <img src="https://cdn.pixabay.com/photo/2021/12/06/13/48/visa-6850402_1280.png" alt="Visa">
              <img src="https://images.unsplash.com/photo-1628625194933-ac2b3c0109e7?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3MzkyNDZ8MHwxfHNlYXJjaHwxfHxtYXN0ZXJjYXJkfGVufDB8fHx8MTc0NjI1NDcwN3ww&ixlib=rb-4.0.3&q=80&w=1080" alt="Mastercard">
              <img src="https://images.unsplash.com/photo-1587906697341-bfbde76785c7?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3MzkyNDZ8MHwxfHNlYXJjaHwxfHxwYXlwYWx8ZW58MHx8fHwxNzQ2Mzc2MTM4fDA&ixlib=rb-4.0.3&q=80&w=1080" alt="Paypal">
            </div>
          </div>
    </footer>


<!-- Styles sélection (ombre thème JO simple) -->
<style>
  .event-card.selectable { cursor: pointer; transition: box-shadow 0.2s ease; }
  .event-card.selectable:hover { box-shadow: 0 0 0 3px rgba(31,117,254,0.35); }
  .event-card.selected { box-shadow: 0 0 0 3px #1f75fe; }
  .btn-add-to-cart.selected { box-shadow: 0 0 0 3px #1f75fe; }
  .msg.info { background: #f0f7ff; border-left: 4px solid #1f75fe; padding: 10px 12px; border-radius: 4px; color:#0b3d91; }
  .msg.warn { background: #fff7e6; border-left: 4px solid #ffab00; color:#7a4e00; }
</style>

<script src="/public/js/app/http.js"></script>
<script src="/public/js/auth.js"></script>
<script src="/static/js/navbar.js"></script>
<!-- Ajout: panier + logique billeterie -->
<script src="/public/js/app/cart.js"></script>
<script src="/public/js/app/billeterie.js"></script>
<section id="evenements" style="margin-top:32px;">
  <h2>Découvrez nos événements</h2>
  <div id="events-list" class="cards" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;"></div>
</section>

<script>
  (async function loadEvents(){
    try {
      const res = await fetch("/api/v1/evenements", { credentials: "same-origin" });
      if (!res.ok) return;
      const events = await res.json();
      const cont = document.getElementById("events-list");
      if (!cont) return;
      cont.innerHTML = (events || []).map(ev => `
        <div class="card" style="border:1px solid #ddd;padding:12px;border-radius:8px;">
          <div style="font-weight:600;">${ev.title || "Événement"}</div>
          <div style="color:#666;">${ev.date ? new Date(ev.date).toLocaleDateString() : ""} ${ev.lieu ? "— " + ev.lieu : ""}</div>
          <p style="margin:8px 0;">${(ev.description || "").slice(0,120)}${(ev.description||"").length>120?"…":""}</p>
          <a href="/session" class="btn">Choisir une offre</a>
        </div>
      `).join("");
    } catch(e) {
      console.warn("chargement événements échoué", e);
    }
  })();
</script>
</body>
</html>