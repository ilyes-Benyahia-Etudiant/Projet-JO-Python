<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Administrateur JO</title>
  <link rel="stylesheet" href="/static/css/style_admin.css">
  <!--<link rel="stylesheet" href="/static/css/index.css">-->
  <link rel="icon" href="/public/images/favicon.ico" type="image/x-icon">
  <meta name="csrf-token" content="{{ csrf_token or request.cookies.get('csrf_token', '') }}">
</head>
<body>
  <header>  
    <nav class="admin-navbar">
      <div class="nav-left">
        <div class="olympic-rings">
            <span class="ring blue"></span>
            <span class="ring yellow"></span>
            <span class="ring black"></span>
            <span class="ring green"></span>
            <span class="ring red"></span>
            
          </div>
        <span class="nav-title">Administeur JO</span>
      </div>
      <div class="nav-right">
        <a href="/admin" class="btn-nav">Rafraîchir</a>
        <a href="/admin/offres/new" class="btn-nav">Ajouter une offre</a>
        <a href="/admin/scan" class="btn-nav">Scanner un billet</a>
        <a href="/admin/evenements/new" class="btn-nav">Ajouter un événement</a>
        <form action="/auth/logout" method="post" style="display:inline;">
          <input type="hidden" name="X-CSRF-Token" value="{{ csrf_token or request.cookies.get('csrf_token', '') }}">
          <button type="submit" class="btn-nav btn-danger">Déconnexion</button>
        </form>
      </div>
    </nav>
  </header>
  <main id="admin-main">
      <div class="card">
        <div class="visual">
          <div class="visual-inner">
            <h1>Espace Admin</h1>
            </div>
          </div>
        </div>

        <div class="form">
          <div class="group">
            <div class="label">Informations</div>
            <div id="admin-user" class="user-card">
              <div><strong>Email:</strong> {{ email or (user and user.get('email')) or '' }}</div>
              <div><strong>Rôle:</strong> {{ role or (user and user.get('role')) or '' }}</div>
            </div>
          </div>

         

          {% if message %}
            <div class="msg ok" style="display:block">{{ message }}</div>
          {% endif %}
          {% if msg %}
            <div class="msg ok" style="display:block">{{ msg }}</div>
          {% endif %}
          {% if error %}
            <div class="msg error" style="display:block">{{ error }}</div>
          {% endif %}

          <div id="admin-dashboard" class="group">
            <div class="label">Tableau de bord</div>
            <div id="cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px;">
              <a href="/admin?view=commandes" id="card-commandes" class="card-item" style="display:block;border:1px solid #ddd; padding:12px; text-decoration:none; color:inherit; cursor:pointer;">
                <div style="font-weight:bold;">Commandes réalisées</div>
                <div id="count-commandes" style="font-size:24px;">{{ commandes_count or 0 }}</div>
                <div style="font-size:12px;color:#666;">Cliquer pour afficher</div>
              </a>
              <a href="/admin?view=users" id="card-users" class="card-item" style="display:block;border:1px solid #ddd; padding:12px; text-decoration:none; color:inherit; cursor:pointer;">
                <div style="font-weight:bold;">Utilisateurs inscrits</div>
                <div id="count-users" style="font-size:24px;">{{ users_count or 0 }}</div>
                <div style="font-size:12px;color:#666;">Cliquer pour afficher</div>
              </a>
              <a href="/admin?view=offres" id="card-offres" class="card-item" style="display:block;border:1px solid #ddd; padding:12px; text-decoration:none; color:inherit; cursor:pointer;">
                <div style="font-weight:bold;">Manage offres</div>
                <div id="count-offres" style="font-size:24px;">{{ offres_count or 0 }}</div>
                <div style="font-size:12px;color:#666;">Cliquer pour afficher</div>
              </a>
              <a href="/admin?view=evenements" id="card-evenements" class="card-item" style="display:block;border:1px solid #ddd; padding:12px; text-decoration:none; color:inherit; cursor:pointer;">
                <div style="font-weight:bold;">Événements</div>
                <div id="count-evenements" style="font-size:24px;">{{ evenements_count or 0 }}</div>
                <div style="font-size:12px;color:#666;">Cliquer pour afficher</div>
              </a>
            </div>
          </div>

          <div id="data-view" class="group">
            <div class="label">Données</div>
            <div id="data-content" class="table-wrap" style="overflow:auto;">

              {% if active_view == 'commandes' %}
                <table class="table">
                  <thead>
                    <tr>
                      <th>id</th>
                      <th>utilisateur</th>
                      <th>offre</th>
                      <th>prix payé</th>
                      <th>token</th>
                      <th>créée le</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if commandes and commandes|length > 0 %}
                      {% for c in commandes %}
                      <tr>
                        <td>{{ c.id }}</td>
                        <td>{{ (c.users and c.users.email) or c.user_id or '' }}</td>
                        <td>{{ (c.offres and c.offres.title) or c.offre_id or '' }}</td>
                        <td>{{ c.price_paid if c.price_paid is not none else '' }}</td>
                        <td>{{ c.token or '' }}</td>
                        <td>{{ c.created_at or '' }}</td>
                        <td>
                          <a class="btn" href="/admin/commandes/{{ c.id }}/edit">Modifier</a>
                          <form action="/admin/commandes/{{ c.id }}/delete" method="post" style="display:inline-block;">
                            <input type="hidden" name="X-CSRF-Token" value="{{ csrf_token or request.cookies.get('csrf_token', '') }}">
                            <button type="submit" onclick="return confirm('Supprimer cette commande ?');">Supprimer</button>
                          </form>
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr><td colspan="7" style="text-align:center;color:#666;">Aucune commande</td></tr>
                    {% endif %}
                  </tbody>
                </table>

              {% elif active_view == 'users' %}
                <table class="table">
                  <thead>
                    <tr>
                      <th>id</th>
                      <th>email</th>
                      <th>nom complet</th>
                      <th>created_at</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if users and users|length > 0 %}
                      {% for u in users %}
                      <tr>
                        <td>{{ u.id }}</td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.full_name or '' }}</td>
                        <td>{{ u.created_at or '' }}</td>
                        <td>
                          <a class="btn" href="/admin/users/{{ u.id }}/edit">Modifier</a>
                          <form action="/admin/users/{{ u.id }}/delete" method="post" style="display:inline-block;">
                            <input type="hidden" name="X-CSRF-Token" value="{{ csrf_token or request.cookies.get('csrf_token', '') }}">
                            <button type="submit" onclick="return confirm('Supprimer cet utilisateur ?');">Supprimer</button>
                          </form>
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr><td colspan="5" style="text-align:center;color:#666;">Aucun utilisateur</td></tr>
                    {% endif %}
                  </tbody>
                </table>

              {% elif active_view == 'offres' %}
                <table class="table">
                  <thead>
                    <tr>
                      <th>id</th>
                      <th>title</th>
                      <th>price</th>
                      <th>category</th>
                      <th>stock</th>
                      <th>created_at</th>
                      <th>updated_at</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if offres and offres|length > 0 %}
                      {% for o in offres %}
                      <tr>
                        <td>{{ o.id }}</td>
                        <td>{{ o.title }}</td>
                        <td>{{ o.price }}</td>
                        <td>{{ o.category }}</td>
                        <td>{{ o.stock }}</td>
                        <td>{{ o.created_at }}</td>
                        <td>{{ o.updated_at }}</td>
                        <td>
                          <a class="btn" href="/admin/offres/{{ o.id }}/edit">Modifier</a>
                          <form action="/admin/offres/{{ o.id }}/delete" method="post" style="display:inline-block;">
                            <input type="hidden" name="X-CSRF-Token" value="{{ csrf_token or request.cookies.get('csrf_token', '') }}">
                            <button type="submit" onclick="return confirm('Supprimer cette offre ?');">Supprimer</button>
                          </form>
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr><td colspan="8" style="text-align:center;color:#666;">Aucune offre</td></tr>
                    {% endif %}
                  </tbody>
                </table>

              {% elif active_view == 'evenements' %}
                <div style="margin-bottom:12px;">
                  <a href="/admin/evenements/new" class="btn">Ajouter un événement</a>
                </div>
                <table class="table">
                  <thead>
                    <tr>
                      <th>id</th>
                      <th>type_evenement</th>
                      <th>nom_evenement</th>
                      <th>lieu</th>
                      <th>date_evenement</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if evenements and evenements|length > 0 %}
                      {% for e in evenements %}
                      <tr>
                        <td>{{ e.id }}</td>
                        <td>{{ e.type_evenement }}</td>
                        <td>{{ e.nom_evenement }}</td>
                        <td>{{ e.lieu }}</td>
                        <td>{{ e.date_evenement }}</td>
                        <td>
                          <a class="btn" href="/admin/evenements/{{ e.id }}/edit">Modifier</a>
                          <form action="/admin/evenements/{{ e.id }}/delete" method="post" style="display:inline-block;">
                            <input type="hidden" name="X-CSRF-Token" value="{{ csrf_token or request.cookies.get('csrf_token', '') }}">
                            <button type="submit" onclick="return confirm('Supprimer cet événement ?');">Supprimer</button>
                          </form>
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr><td colspan="6" style="text-align:center;color:#666;">Aucun événement</td></tr>
                    {% endif %}
                  </tbody>
                </table>

              {% else %}
                <div style="color:#666;">
                  Sélectionnez une section via les cartes du tableau de bord ci-dessus (Commandes, Utilisateurs ou Offres).
                </div>
              {% endif %}

            </div>
          </div>
        </div>
      </div>
  </main>
</body>
</html>